<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="author" content="Giovanni Fossati" />


<title>Stock Market Returns Distributions</title>

<script src="report_files/jquery-1.11.0/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="report_files/bootstrap-3.3.1/css/cerulean.min.css" rel="stylesheet" />
<script src="report_files/bootstrap-3.3.1/js/bootstrap.min.js"></script>
<script src="report_files/bootstrap-3.3.1/shim/html5shiv.min.js"></script>
<script src="report_files/bootstrap-3.3.1/shim/respond.min.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; background-color: #f8f8f8; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
pre, code { background-color: #f8f8f8; }
code > span.kw { color: #204a87; font-weight: bold; }
code > span.dt { color: #204a87; }
code > span.dv { color: #0000cf; }
code > span.bn { color: #0000cf; }
code > span.fl { color: #0000cf; }
code > span.ch { color: #4e9a06; }
code > span.st { color: #4e9a06; }
code > span.co { color: #8f5902; font-style: italic; }
code > span.ot { color: #8f5902; }
code > span.al { color: #ef2929; }
code > span.fu { color: #000000; }
code > span.er { font-weight: bold; }
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<link rel="stylesheet" href="css/gf_new.css" type="text/css" />

</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img { 
  max-width:100%; 
  height: auto; 
}
</style>
<div class="container-fluid main-container">


<div id="header">
<h1 class="title">Stock Market Returns Distributions</h1>
<h4 class="author"><em>Giovanni Fossati</em></h4>
</div>


<div id="preliminaries" class="section level2">
<h2>PRELIMINARIES</h2>
<p>Libraries needed for data processing and plotting:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># library(&quot;lubridate&quot;)</span>
<span class="co"># library(&quot;plyr&quot;)</span>
<span class="kw">library</span>(<span class="st">&quot;ggplot2&quot;</span>)
<span class="kw">library</span>(<span class="st">&quot;gridExtra&quot;</span>)</code></pre>
</div>
<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>Two interesting, blog posts:</p>
<ul>
<li><a href="http://www.r-bloggers.com/the-generalized-lambda-distribution-and-gldex-package-fitting-financial-return-data/">The Generalized Lambda Distribution and GLDEX Package: Fitting Financial Return Data</a></li>
<li><a href="http://www.r-bloggers.com/the-generalized-lambda-distribution-and-gldex-package-for-fitting-financial-return-data-part-2/">The Generalized Lambda Distribution and GLDEX Package for Fitting Financial Return Data â€“ Part 2</a></li>
</ul>
<p>The GLDEX package is available on <a href="http://cran.r-project.org/web/packages/GLDEX/index.html">CRAN</a></p>
<p><a name="THE_DATA"></a></p>
</div>
<div id="libraries-and-other-setup" class="section level2">
<h2>Libraries and Other Setup</h2>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;quantmod&quot;</span>)
<span class="kw">library</span>(<span class="st">&quot;GLDEX&quot;</span>)
<span class="kw">library</span>(<span class="st">&quot;MASS&quot;</span>)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(<span class="st">&quot;scales&quot;</span>)
<span class="kw">source</span>(<span class="st">&quot;./my_functions.R&quot;</span>)</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">start.date &lt;-<span class="st"> &quot;1986-01-01&quot;</span>
end.date &lt;-<span class="st"> &quot;2014-12-31&quot;</span>

xxlin &lt;-<span class="st"> </span><span class="kw">seq</span>(-<span class="fl">25.0</span>, <span class="fl">25.0</span>, <span class="dt">by =</span> <span class="fl">0.1</span>)
xxlog &lt;-<span class="st"> </span><span class="kw">seq</span>(-<span class="fl">2.0</span>, <span class="fl">2.0</span>, <span class="dt">by =</span> <span class="fl">0.001</span>)</code></pre>
<hr class="thin_separator">
</div>
<div id="three-broad-market-indices-daily-returns" class="section level1">
<h1>Three Broad Market Indices : Daily Returns</h1>
<div id="wilshire-5000" class="section level2">
<h2>Wilshire 5000</h2>
<p>Fetch the data with <code>quantmod</code>:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># getSymbols(&quot;VTSMX&quot;, from = &quot;1994-01-01&quot;)</span>
<span class="kw">getSymbols</span>(<span class="st">&quot;VTSMX&quot;</span>, <span class="dt">from =</span> start.date, <span class="dt">to =</span> end.date)
<span class="co"># [1] &quot;VTSMX&quot;</span>
VTSMX.vec &lt;-<span class="st"> </span><span class="kw">as.vector</span>(VTSMX[, <span class="dv">4</span>])</code></pre>
<p>Prepare returns:</p>
<pre class="sourceCode r"><code class="sourceCode r">WW &lt;-<span class="st"> </span><span class="kw">prepare_data</span>(<span class="dt">data =</span> VTSMX.vec, <span class="dt">xlin =</span> xxlin, <span class="dt">xlog =</span> xxlog)
WW$dates &lt;-<span class="st"> </span><span class="kw">index</span>(VTSMX)
WW$year &lt;-<span class="st"> </span><span class="kw">substr</span>(<span class="kw">index</span>(VTSMX), <span class="dv">1</span>, <span class="dv">4</span>)</code></pre>
<div id="distributions-of-relative-returns-and-of-log-returns" class="section level4">
<h4>Distributions of <em>relative returns</em> and of <em>log returns</em>:</h4>
<p><img src="figures/wilshire5000-plot_distributions_ggplot_3-1.png" title="" alt="" width="1000" style="display: block; margin: auto;" /></p>
<hr class="thin_separator">
</div>
<div id="sp-500" class="section level3">
<h3>S&amp;P 500</h3>
<p>Fetch the data with <code>quantmod</code>:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">getSymbols</span>(<span class="st">&quot;^GSPC&quot;</span>, <span class="dt">from =</span> start.date, <span class="dt">to =</span> end.date)
<span class="co"># [1] &quot;GSPC&quot;</span>
GSPC.vec &lt;-<span class="st"> </span><span class="kw">as.vector</span>(GSPC[, <span class="dv">4</span>])</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">SP &lt;-<span class="st"> </span><span class="kw">prepare_data</span>(<span class="dt">data =</span> GSPC.vec, <span class="dt">xlin =</span> xxlin, <span class="dt">xlog =</span> xxlog)
SP$dates &lt;-<span class="st"> </span><span class="kw">index</span>(GSPC)
SP$year &lt;-<span class="st"> </span><span class="kw">substr</span>(<span class="kw">index</span>(GSPC), <span class="dv">1</span>, <span class="dv">4</span>)</code></pre>
<div id="distributions-of-relative-returns-and-of-log-returns-1" class="section level4">
<h4>Distributions of <em>relative returns</em> and of <em>log returns</em>:</h4>
<p><img src="figures/sp500-plot_distributions_ggplot_3-1.png" title="" alt="" width="1000" style="display: block; margin: auto;" /></p>
<hr class="thin_separator">
</div>
</div>
<div id="nasdaq-100" class="section level3">
<h3>NASDAQ 100</h3>
<p>Fetch the data with <code>quantmod</code>:</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">getSymbols</span>(<span class="st">&quot;^NDX&quot;</span>, <span class="dt">from =</span> start.date, <span class="dt">to =</span> end.date)
<span class="co"># [1] &quot;NDX&quot;</span>
NDX.vec &lt;-<span class="st"> </span><span class="kw">as.vector</span>(NDX[, <span class="dv">4</span>])</code></pre>
<pre class="sourceCode r"><code class="sourceCode r">NN &lt;-<span class="st"> </span><span class="kw">prepare_data</span>(<span class="dt">data =</span> NDX.vec, <span class="dt">xlin =</span> xxlin, <span class="dt">xlog =</span> xxlog)
NN$dates &lt;-<span class="st"> </span><span class="kw">index</span>(NDX)
NN$year &lt;-<span class="st"> </span><span class="kw">substr</span>(<span class="kw">index</span>(NDX), <span class="dv">1</span>, <span class="dv">4</span>)</code></pre>
<div id="distributions-of-relative-returns-and-of-log-returns-2" class="section level4">
<h4>Distributions of <em>relative returns</em> and of <em>log returns</em>:</h4>
<p><img src="figures/nasdaq100-plot_distributions_ggplot_3-1.png" title="" alt="" width="1000" style="display: block; margin: auto;" /></p>
<hr class="thin_separator">
</div>
</div>
</div>
</div>
<div id="three-broad-market-indices-daily-returns-1" class="section level1">
<h1>Three Broad Market Indices : Daily Returns</h1>
<div id="annual-from-daily-returns" class="section level2">
<h2>Annual from Daily Returns</h2>
<p>Simulating annual returns by compounding daily returns drawn from the best fit <em>generalized gamma distributions</em>.</p>
<pre class="sourceCode r"><code class="sourceCode r"><span class="co"># typical number of market days in a year is ~252</span>
ndays &lt;-<span class="st"> </span><span class="dv">252</span>

<span class="co"># repeats</span>
  N &lt;-<span class="st"> </span><span class="fl">1e5</span>
<span class="co"># N &lt;- 1e6</span>

<span class="kw">set.seed</span>(<span class="dv">1212</span>)
test_rr.W5000 &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">0</span>, N)
for(j in <span class="dv">1</span>:N) {
    dummy &lt;-<span class="st"> </span><span class="kw">rgl</span>(ndays, WW$rr_fit_gl)
    test_rr.W5000[j] &lt;-<span class="st"> </span>(<span class="kw">cumprod</span>(<span class="dv">1</span> +<span class="st"> </span>dummy/<span class="dv">100</span>)[ndays] -<span class="st"> </span><span class="fl">1.0</span>)*<span class="dv">100</span>
}

test_rr.SP500 &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">0</span>, N)
for(j in <span class="dv">1</span>:N) {
    dummy &lt;-<span class="st"> </span><span class="kw">rgl</span>(ndays, SP$rr_fit_gl)
    test_rr.SP500[j] &lt;-<span class="st"> </span>(<span class="kw">cumprod</span>(<span class="dv">1</span> +<span class="st"> </span>dummy/<span class="dv">100</span>)[ndays] -<span class="st"> </span><span class="fl">1.0</span>)*<span class="dv">100</span>
}

test_rr.N100 &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">0</span>, N)
for(j in <span class="dv">1</span>:N) {
    dummy &lt;-<span class="st"> </span><span class="kw">rgl</span>(ndays, NN$rr_fit_gl)
    test_rr.N100[j] &lt;-<span class="st"> </span>(<span class="kw">cumprod</span>(<span class="dv">1</span> +<span class="st"> </span>dummy/<span class="dv">100</span>)[ndays] -<span class="st"> </span><span class="fl">1.0</span>)*<span class="dv">100</span>
}</code></pre>
<p><img src="figures/plot-annual_returns_distr_1-1.png" title="" alt="" width="800" style="display: block; margin: auto;" /></p>
</div>
<div id="annual-straight-from-data" class="section level2">
<h2>Annual straight from data</h2>
<p><img src="figures/plot-annual_returns_distr_2-1.png" title="" alt="" width="800" style="display: block; margin: auto;" /></p>
<p><img src="figures/plot-annual_returns_timeseries_ggplot-1.png" title="" alt="" width="1000" style="display: block; margin: auto;" /></p>
<p><img src="figures/plot-indices_timeseries_ggplot_norm-1.png" title="" alt="" width="1000" style="display: block; margin: auto;" /></p>
<hr class="separator">
<p><a name="APPENDIX"></a></p>
</div>
</div>
<div id="appendix" class="section level1">
<h1>APPENDIX</h1>
<p><a name="SessionInfo"></a></p>
<div id="r-session-info" class="section level2">
<h2>R Session Info</h2>
<pre class="sourceCode r"><code class="sourceCode r"><span class="kw">sessionInfo</span>()
<span class="co"># R version 3.1.3 (2015-03-09)</span>
<span class="co"># Platform: x86_64-pc-linux-gnu (64-bit)</span>
<span class="co"># Running under: Ubuntu 14.04.2 LTS</span>
<span class="co"># </span>
<span class="co"># locale:</span>
<span class="co">#  [1] LC_CTYPE=en_US.UTF-8       LC_NUMERIC=C               LC_TIME=en_US.UTF-8       </span>
<span class="co">#  [4] LC_COLLATE=C               LC_MONETARY=en_US.UTF-8    LC_MESSAGES=en_US.UTF-8   </span>
<span class="co">#  [7] LC_PAPER=en_US.UTF-8       LC_NAME=C                  LC_ADDRESS=C              </span>
<span class="co"># [10] LC_TELEPHONE=C             LC_MEASUREMENT=en_US.UTF-8 LC_IDENTIFICATION=C       </span>
<span class="co"># </span>
<span class="co"># attached base packages:</span>
<span class="co"># [1] grid      stats     graphics  grDevices utils     datasets  methods   base     </span>
<span class="co"># </span>
<span class="co"># other attached packages:</span>
<span class="co">#  [1] scales_0.2.4    MASS_7.3-41     GLDEX_2.0.0.2   cluster_2.0.1   quantmod_0.4-4  TTR_0.22-0     </span>
<span class="co">#  [7] xts_0.9-7       zoo_1.7-12      gridExtra_0.9.1 ggplot2_1.0.1   knitr_1.10.5   </span>
<span class="co"># </span>
<span class="co"># loaded via a namespace (and not attached):</span>
<span class="co">#  [1] Rcpp_0.11.6      colorspace_1.2-6 digest_0.6.8     evaluate_0.7     formatR_1.2     </span>
<span class="co">#  [6] gtable_0.1.2     htmltools_0.2.6  labeling_0.3     lattice_0.20-31  magrittr_1.5    </span>
<span class="co"># [11] munsell_0.4.2    plyr_1.8.3       proto_0.3-10     reshape2_1.4.1   rmarkdown_0.7   </span>
<span class="co"># [16] stringi_0.5-5    stringr_1.0.0    tools_3.1.3      yaml_2.1.13</span></code></pre>
<hr />
</div>
</div>


</div>

<script>

// add bootstrap table styles to pandoc tables
$(document).ready(function () {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
});

</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
